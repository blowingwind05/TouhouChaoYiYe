module win(
    input clk,
    input start,
    input rstn,
    input wire [15:0] frac,      
    input [2:0]speedup,
    output reg B
    );
    reg [24:1]t;
    reg [24:1]total;
    reg clk_out;

    always@(posedge clk,negedge rstn)
        if(~rstn) total<=3125000;
        // else if(speedup==1) total<=3125000;
        else if(speedup==2) total<=3125000;
        else total<=3125000;

    always@(posedge clk,negedge rstn)
        if(~rstn) begin clk_out<=0;t<=total; end
        else if(t==0) begin clk_out<=~clk_out;t<=total; end
        else begin t<=t-1; end
    reg [10:0]state;
    always@(posedge clk_out,negedge rstn)         
        if(~rstn) state<=0;
        else if(start) begin
            if(state!=288)state<=state+1;
            else state<=0;
        end
    reg [6:1]m;
    always@(*)
    if(start)
        case(state) 
    0 : m = 0;
1 : m = 0;
2 : m = 0;
3 : m = 0;
4 : m = 0;
5 : m = 0;
6 : m = 0;
7 : m = 0;
8 : m = 0;
9 : m = 0;
10 : m = 0;
11 : m = 0;
12 : m = 0;
13 : m = 0;
14 : m = 0;
15 : m = 0;
16 : m = 0;
17 : m = 0;
18 : m = 0;
19 : m = 0;
20 : m = 3;
21 : m = 3;
22 : m = 3;
23 : m = 3;
24 : m = 0;
25 : m = 3;
26 : m = 3;
27 : m = 3;
28 : m = 5;
29 : m = 5;
30 : m = 5;
31 : m = 5;
32 : m = 6;
33 : m = 6;
34 : m = 6;
35 : m = 6;
36 : m = 6;
37 : m = 6;
38 : m = 6;
39 : m = 6;
40 : m = 6;
41 : m = 6;
42 : m = 6;
43 : m = 6;
44 : m = 5;
45 : m = 5;
46 : m = 6;
47 : m = 6;
48 : m = 5;
49 : m = 5;
50 : m = 5;
51 : m = 5;
52 : m = 3;
53 : m = 3;
54 : m = 3;
55 : m = 3;
56 : m = 2;
57 : m = 2;
58 : m = 2;
59 : m = 2;
60 : m = 5;
61 : m = 5;
62 : m = 5;
63 : m = 5;
64 : m = 3;
65 : m = 3;
66 : m = 3;
67 : m = 3;
68 : m = 3;
69 : m = 3;
70 : m = 3;
71 : m = 3;
72 : m = 3;
73 : m = 3;
74 : m = 3;
75 : m = 3;
76 : m = 3;
77 : m = 3;
78 : m = 3;
79 : m = 3;
80 : m = 0;
81 : m = 0;
82 : m = 0;
83 : m = 0;
84 : m = 3;
85 : m = 3;
86 : m = 3;
87 : m = 3;
88 : m = 0;
89 : m = 3;
90 : m = 3;
91 : m = 3;
92 : m = 5;
93 : m = 5;
94 : m = 5;
95 : m = 5;
96 : m = 6;
97 : m = 6;
98 : m = 6;
99 : m = 6;
100 : m = 6;
101 : m = 6;
102 : m = 6;
103 : m = 6;
104 : m = 5;
105 : m = 5;
106 : m = 6;
107 : m = 6;
108 : m = 8;
109 : m = 8;
110 : m = 8;
111 : m = 8;
112 : m = 8;
113 : m = 8;
114 : m = 8;
115 : m = 8;
116 : m = 7;
117 : m = 7;
118 : m = 7;
119 : m = 7;
120 : m = 6;
121 : m = 6;
122 : m = 6;
123 : m = 6;
124 : m = 5;
125 : m = 5;
126 : m = 5;
127 : m = 5;
128 : m = 6;
129 : m = 6;
130 : m = 6;
131 : m = 6;
132 : m = 6;
133 : m = 6;
134 : m = 6;
135 : m = 6;
136 : m = 6;
137 : m = 6;
138 : m = 6;
139 : m = 6;
140 : m = 6;
141 : m = 6;
142 : m = 6;
143 : m = 6;
144 : m = 0;
145 : m = 0;
146 : m = 0;
147 : m = 0;
148 : m = 5;
149 : m = 5;
150 : m = 6;
151 : m = 6;
152 : m = 5;
153 : m = 5;
154 : m = 5;
155 : m = 5;
156 : m = 3;
157 : m = 3;
158 : m = 3;
159 : m = 3;
160 : m = 2;
161 : m = 2;
162 : m = 2;
163 : m = 2;
164 : m = 2;
165 : m = 2;
166 : m = 2;
167 : m = 2;
168 : m = 2;
169 : m = 2;
170 : m = 2;
171 : m = 2;
172 : m = 2;
173 : m = 2;
174 : m = 2;
175 : m = 2;
176 : m = 0;
177 : m = 0;
178 : m = 0;
179 : m = 0;
180 : m = 5;
181 : m = 5;
182 : m = 6;
183 : m = 6;
184 : m = 5;
185 : m = 5;
186 : m = 5;
187 : m = 5;
188 : m = 2;
189 : m = 2;
190 : m = 2;
191 : m = 2;
192 : m = 1;
193 : m = 1;
194 : m = 1;
195 : m = 1;
196 : m = 1;
197 : m = 1;
198 : m = 1;
199 : m = 1;
200 : m = 1;
201 : m = 1;
202 : m = 1;
203 : m = 1;
204 : m = 1;
205 : m = 1;
206 : m = 1;
207 : m = 1;
208 : m = 0;
209 : m = 0;
210 : m = 0;
211 : m = 0;
212 : m = 0;
213 : m = 0;
214 : m = 0;
215 : m = 0;
216 : m = 16;
217 : m = 16;
218 : m = 16;
219 : m = 16;
220 : m = 17;
221 : m = 17;
222 : m = 17;
223 : m = 17;
224 : m = 1;
225 : m = 1;
226 : m = 1;
227 : m = 1;
228 : m = 1;
229 : m = 1;
230 : m = 1;
231 : m = 1;
232 : m = 1;
233 : m = 1;
234 : m = 1;
235 : m = 1;
236 : m = 2;
237 : m = 2;
238 : m = 2;
239 : m = 2;
240 : m = 17;
241 : m = 17;
242 : m = 17;
243 : m = 17;
244 : m = 17;
245 : m = 17;
246 : m = 17;
247 : m = 17;
248 : m = 0;
249 : m = 0;
250 : m = 0;
251 : m = 0;
252 : m = 16;
253 : m = 16;
254 : m = 16;
255 : m = 16;
256 : m = 16;
257 : m = 0;
258 : m = 16;
259 : m = 16;
260 : m = 16;
261 : m = 16;
262 : m = 16;
263 : m = 16;
264 : m = 16;
265 : m = 16;
266 : m = 16;
267 : m = 16;
268 : m = 16;
269 : m = 16;
270 : m = 16;
271 : m = 16;
272 : m = 0;
273 : m = 0;
274 : m = 0;
275 : m = 0;
276 : m = 0;
277 : m = 0;
278 : m = 0;
279 : m = 0;
280 : m = 0;
281 : m = 0;
282 : m = 0;
283 : m = 0;
284 : m = 0;
285 : m = 0;
286 : m = 0;
287 : m = 0;
default: m=0;
        endcase
    else m=0;

    reg [27:1]q;
    always@(*)
    begin
        case(m)//C大调
        0: q=0;
        1: q=100000000/262 ;
        2: q=100000000/294 ;
        3: q=100000000/330 ;
        4: q=100000000/349 ;
        5: q=100000000/392 ;
        6: q=100000000/440 ;
        7: q=100000000/494 ;
        8: q=100000000/523 ;
        16: q=100000000/220 ;
        17: q=100000000/247 ;
        default:q=0;
        endcase    
    end
 
    reg [27:1]p;
    reg [27:1]tt;
    always@(posedge clk,negedge rstn)      
    begin
        if(~rstn) begin B<=0;p<=0; end
        else begin
            tt<=q;
            if(q==0||tt!=q)
            begin
                if(q==0) begin B<=0; end
                if(tt!=q) begin p<=0; end
            end
            else
            begin 
                if(p==q-1) p<=0;
                else p<=p+1;
                if(p==0) B<=1;
                if(p==q/frac) B<=0;//占空比控制音量
            end
        end
    end 
endmodule

